<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="./home_files/all.min.css">
    <link href="./home_files/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./home_files/style.css">
    
    <title>Administrace | Raketoví inženýři</title>

    <style>
        .table-responsive { max-height: 80vh; }
        thead th {
            position: sticky; top: 0; background-color: #1c1e26 !important;
            z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            cursor: pointer; /* Indikuje, že se dá kliknout */
            user-select: none; /* Zabrání označování textu při rychlém klikání */
        }
        thead th:hover {
            background-color: #2d3748 !important; /* Efekt po najetí myší */
        }
        /* Styl pro input type="date" */
        input[type="date"] {
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }
        /* Ikona řazení */
        .sort-icon {
            float: right;
            color: #6c757d;
            font-size: 0.8rem;
            margin-top: 4px;
        }
        .sorted-active {
            color: white !important; /* Aktivní ikona svítí bíle */
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark navbar-render sticky-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-2" href="index.php">
                <i class="fa-solid fa-rocket"></i>
                RAKETOVÍ INŽENÝŘI <span class="badge bg-danger ms-2 text-white" style="font-size: 0.7rem;">ADMIN</span>
            </a>
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div id="navMenu" class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto align-items-center gap-3">
                    <li class="nav-item"><a class="nav-link" href="index.php">Zpět na web</a></li>
                    <li class="nav-item"><span class="text-secondary small">Přihlášen: Admin</span></li>
                    <li class="nav-item"><a class="btn btn-sm btn-outline-danger px-3 py-2 rounded-2" href="#">Odhlásit</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-start m-0">Přehled článků v systému</h2>
            <button class="btn btn-success" onclick="alert('Otevřel by se formulář pro nový článek.')"><i class="fa-solid fa-plus me-2"></i>Nový článek</button>
        </div>

        <div class="article-card mb-4">
            <div class="body">
                <h5 class="mb-3 text-white"><i class="fa-solid fa-filter me-2 text-primary"></i>Filtrování a vyhledávání</h5>
                <form class="row g-3" onsubmit="event.preventDefault();">
                    <div class="col-md-6">
                        <label for="searchTitle" class="form-label">Název nebo autor</label>
                        <input type="text" class="form-control" id="searchTitle" placeholder="Začněte psát..." onkeyup="app.filterAndPaginate()">
                    </div>
                    <div class="col-md-3">
                        <label for="filterCategory" class="form-label">Kategorie</label>
                        <select id="filterCategory" class="form-select" onchange="app.filterAndPaginate()">
                            <option value="all" selected>Všechny kategorie</option>
                            <option value="Mix">Mix</option>
                            <option value="Zábava">Zábava</option>
                            <option value="Věda">Věda</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="filterStatus" class="form-label">Stav zpracování</label>
                        <select id="filterStatus" class="form-select" onchange="app.filterAndPaginate()">
                            <option value="all" selected>Všechny stavy</option>
                            <option value="new">Nový (K přiřazení)</option>
                            <option value="review">V recenzním řízení</option>
                            <option value="approved">Schváleno</option>
                        </select>
                    </div>
                </form>
            </div>
        </div>

        <nav aria-label="Page navigation top" class="mb-2">
            <ul class="pagination justify-content-end" id="paginationListTop"></ul>
        </nav>

        <div class="table-responsive">
            <table class="table table-hover align-middle" id="articlesTable">
                <thead>
                    <tr>
                        <th scope="col" onclick="app.sortTable('id')">ID <i class="fa-solid fa-sort sort-icon" id="icon-id"></i></th>
                        <th scope="col" style="width: 30%;" onclick="app.sortTable('title')">Název článku <i class="fa-solid fa-sort sort-icon" id="icon-title"></i></th>
                        <th scope="col" onclick="app.sortTable('author')">Autor <i class="fa-solid fa-sort sort-icon" id="icon-author"></i></th>
                        <th scope="col" onclick="app.sortTable('category')">Kategorie <i class="fa-solid fa-sort sort-icon" id="icon-category"></i></th>
                        <th scope="col" onclick="app.sortTable('date')">Datum <i class="fa-solid fa-sort sort-icon" id="icon-date"></i></th>
                        <th scope="col" onclick="app.sortTable('status')">Stav <i class="fa-solid fa-sort sort-icon" id="icon-status"></i></th>
                        <th scope="col" class="text-end" style="cursor: default;">Akce</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr class="article-row" id="row-1024" data-category="Věda" data-status="new">
                        <td>#1024</td>
                        <td><strong>Vliv mikrogravitace na růst rajčat</strong></td>
                        <td>Jan Novák</td>
                        <td>Věda</td>
                        <td>09.12.2025</td>
                        <td id="status-1024"><span class="badge bg-warning text-dark">Čeká na recenzenta</span></td>
                        <td class="text-end">
                            <button class="btn btn-sm btn-info" title="Přiřadit recenzenty" onclick="app.openAssignModal(1024)"><i class="fa-solid fa-user-plus"></i></button>
                            <button class="btn btn-sm btn-secondary" title="Detail"><i class="fa-solid fa-eye"></i></button>
                        </td>
                    </tr>

                    <tr class="article-row" id="row-1023" data-category="Mix" data-status="review">
                        <td>#1023</td>
                        <td><strong>Historie raketoplánů Buran</strong></td>
                        <td>Petr Svoboda</td>
                        <td>Mix</td>
                        <td>08.12.2025</td>
                        <td><span class="badge bg-primary">V recenzi</span></td>
                        <td class="text-end">
                            <button class="btn btn-sm btn-secondary" title="Zobrazit zprávy/recenze" onclick="alert('Interní zprávy: Žádné nové komentáře.')"><i class="fa-solid fa-comments"></i></button>
                            <button class="btn btn-sm btn-secondary" title="Detail"><i class="fa-solid fa-eye"></i></button>
                        </td>
                    </tr>

                    <tr class="article-row" id="row-1020" data-category="Zábava" data-status="approved">
                        <td>#1020</td>
                        <td><strong>Proč je vesmír tichý?</strong></td>
                        <td>Anna Dvořáková</td>
                        <td>Zábava</td>
                        <td>01.12.2025</td>
                        <td><span class="badge bg-success">Publikováno</span></td>
                        <td class="text-end">
                            <button class="btn btn-sm btn-danger" title="Stáhnout z oběhu" onclick="app.deleteArticle(1020)"><i class="fa-solid fa-trash"></i></button>
                            <button class="btn btn-sm btn-secondary" title="Detail"><i class="fa-solid fa-eye"></i></button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <nav aria-label="Page navigation bottom">
            <ul class="pagination justify-content-center" id="paginationListBottom"></ul>
        </nav>
    </div>

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-12 text-center text-secondary small">
                    © 2025 Raketoví inženýři Inc. Administrační rozhraní.
                </div>
            </div>
        </div>
    </footer>

    <div class="modal fade" id="assignReviewerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark border border-secondary text-white">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title">Přiřadit recenzenty k článku <span id="assignModalArticleId"></span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="small text-muted">Vyberte 1 až 2 recenzenty a nastavte termín odevzdání posudku.</p>
                    <div class="mb-3">
                        <label class="form-label text-white small fw-bold">Termín odevzdání recenze:</label>
                        <input type="date" class="form-control" id="reviewDate">
                    </div>
                    <div class="list-group list-group-flush mb-3">
                        <label class="list-group-item bg-transparent text-white border-secondary d-flex justify-content-between align-items-center" style="cursor:pointer">
                            <div>
                                <input class="form-check-input me-2 reviewer-checkbox" type="checkbox" value="Alice">
                                <strong>Ing. Alice Chytrá</strong>
                                <div class="small text-success"><i class="fa-solid fa-check-circle"></i> Volná kapacita (0/3)</div>
                            </div>
                            <span class="badge bg-secondary">Biologie</span>
                        </label>
                        <label class="list-group-item bg-transparent text-white border-secondary d-flex justify-content-between align-items-center" style="cursor:pointer">
                            <div>
                                <input class="form-check-input me-2 reviewer-checkbox" type="checkbox" value="Borek">
                                <strong>Doc. Bořek Stavitel</strong>
                                <div class="small text-warning"><i class="fa-solid fa-clock"></i> Částečně vytížen (2/3)</div>
                            </div>
                            <span class="badge bg-secondary">Věda</span>
                        </label>
                        <label class="list-group-item bg-transparent text-muted border-secondary d-flex justify-content-between align-items-center opacity-50">
                            <div>
                                <input class="form-check-input me-2" type="checkbox" disabled>
                                <strong>Prof. Cyril Dlouhý</strong>
                                <div class="small text-danger"><i class="fa-solid fa-ban"></i> Přetížen (3/3)</div>
                            </div>
                            <span class="badge bg-secondary">Věda</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zrušit</button>
                    <button type="button" class="btn btn-primary" onclick="app.confirmAssignment()">Odeslat pozvánky</button>
                </div>
            </div>
        </div>
    </div>

    <script src="./home_files/bootstrap.bundle.min.js.stažený soubor"></script>
    
    <script>
        const app = {
            itemsPerPage: 12,
            currentPage: 1,
            allRows: [],
            currentArticleId: null,
            // NOVÉ: Stav pro řazení
            currentSortColumn: null,
            currentSortDirection: 'asc', // nebo 'desc'

            init: function() {
                const rows = document.querySelectorAll('#articlesTable tbody tr');
                const tbody = document.getElementById('tableBody');
                
                // GENERÁTOR DAT (cca 27 celkem)
                for(let i = 0; i < 8; i++) { 
                    rows.forEach(row => {
                        let clone = row.cloneNode(true);
                        clone.id = row.id + "_" + i; 
                        // Pro účely testování řazení mírně změníme data v klonech, aby to nebylo stejné
                        if(i % 2 === 0) {
                            clone.cells[2].innerText = "Zdeněk Klonovaný"; // Změna autora
                            clone.cells[4].innerText = "01.01.2024"; // Změna data
                        }
                        tbody.appendChild(clone);
                    });
                }

                this.allRows = Array.from(document.querySelectorAll('#articlesTable tbody tr'));
                this.filterAndPaginate();
            },

            // NOVÉ: Funkce pro řazení
            sortTable: function(column) {
                // Přepínání směru řazení
                if (this.currentSortColumn === column) {
                    this.currentSortDirection = this.currentSortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    this.currentSortColumn = column;
                    this.currentSortDirection = 'asc';
                }

                // Aktualizace ikon
                document.querySelectorAll('.sort-icon').forEach(icon => {
                    icon.className = 'fa-solid fa-sort sort-icon'; // Reset
                });
                const activeIcon = document.getElementById('icon-' + column);
                if (activeIcon) {
                    activeIcon.className = this.currentSortDirection === 'asc' 
                        ? 'fa-solid fa-sort-up sort-icon sorted-active' 
                        : 'fa-solid fa-sort-down sort-icon sorted-active';
                }

                // Samotné řazení pole allRows
                this.allRows.sort((a, b) => {
                    let valA, valB;

                    // Získání hodnot podle sloupce
                    switch(column) {
                        case 'id':
                            valA = parseInt(a.cells[0].innerText.replace('#', ''));
                            valB = parseInt(b.cells[0].innerText.replace('#', ''));
                            break;
                        case 'title':
                            valA = a.cells[1].innerText.toLowerCase();
                            valB = b.cells[1].innerText.toLowerCase();
                            break;
                        case 'author':
                            valA = a.cells[2].innerText.toLowerCase();
                            valB = b.cells[2].innerText.toLowerCase();
                            break;
                        case 'category':
                            valA = a.cells[3].innerText.toLowerCase();
                            valB = b.cells[3].innerText.toLowerCase();
                            break;
                        case 'date':
                            // Parsování českého data dd.mm.yyyy
                            const datePartsA = a.cells[4].innerText.split('.');
                            const datePartsB = b.cells[4].innerText.split('.');
                            valA = new Date(datePartsA[2], datePartsA[1] - 1, datePartsA[0]);
                            valB = new Date(datePartsB[2], datePartsB[1] - 1, datePartsB[0]);
                            break;
                        case 'status':
                            valA = a.cells[5].innerText.toLowerCase();
                            valB = b.cells[5].innerText.toLowerCase();
                            break;
                    }

                    if (valA < valB) return this.currentSortDirection === 'asc' ? -1 : 1;
                    if (valA > valB) return this.currentSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });

                // Překreslení
                this.filterAndPaginate();
            },

            filterAndPaginate: function() {
                const searchText = document.getElementById('searchTitle').value.toLowerCase();
                const categoryFilter = document.getElementById('filterCategory').value;
                const statusFilter = document.getElementById('filterStatus').value;

                // 1. FILTRACE
                const visibleRows = this.allRows.filter(row => {
                    let title = row.getElementsByTagName('td')[1].innerText.toLowerCase();
                    let author = row.getElementsByTagName('td')[2].innerText.toLowerCase();
                    let category = row.getAttribute('data-category');
                    let status = row.getAttribute('data-status');

                    let textMatch = title.includes(searchText) || author.includes(searchText);
                    let categoryMatch = (categoryFilter === 'all' || category === categoryFilter);
                    let statusMatch = (statusFilter === 'all' || status === statusFilter);

                    return textMatch && categoryMatch && statusMatch;
                });

                // 2. STRÁNKOVÁNÍ
                const totalPages = Math.ceil(visibleRows.length / this.itemsPerPage);
                
                if (this.currentPage > totalPages) this.currentPage = 1;
                if (this.currentPage < 1) this.currentPage = 1;

                // 3. ZOBRAZENÍ (vkládáme seřazené řádky zpět do DOMu)
                const tbody = document.getElementById('tableBody');
                tbody.innerHTML = ''; // Vyčistíme tabulku

                const start = (this.currentPage - 1) * this.itemsPerPage;
                const end = start + this.itemsPerPage;
                const paginatedRows = visibleRows.slice(start, end);

                paginatedRows.forEach(row => {
                    row.style.display = '';
                    tbody.appendChild(row); // Vložíme řádek ve správném pořadí
                });

                this.renderPaginationControls(totalPages);
            },

            renderPaginationControls: function(totalPages) {
                let paginationHTML = '';
                if (totalPages > 1) {
                    let prevClass = this.currentPage === 1 ? 'disabled' : '';
                    paginationHTML += `<li class="page-item ${prevClass}"><a class="page-link" href="#" onclick="app.changePage(${this.currentPage - 1})">Předchozí</a></li>`;
                    for (let i = 1; i <= totalPages; i++) {
                        let activeClass = i === this.currentPage ? 'active' : '';
                        paginationHTML += `<li class="page-item ${activeClass}"><a class="page-link" href="#" onclick="app.changePage(${i})">${i}</a></li>`;
                    }
                    let nextClass = this.currentPage === totalPages ? 'disabled' : '';
                    paginationHTML += `<li class="page-item ${nextClass}"><a class="page-link" href="#" onclick="app.changePage(${this.currentPage + 1})">Další</a></li>`;
                }
                document.getElementById('paginationListTop').innerHTML = paginationHTML;
                document.getElementById('paginationListBottom').innerHTML = paginationHTML;
            },

            changePage: function(newPage) {
                this.currentPage = newPage;
                this.filterAndPaginate();
            },

            openAssignModal: function(id) {
                this.currentArticleId = id;
                document.getElementById('assignModalArticleId').innerText = '#' + id;
                document.querySelectorAll('.reviewer-checkbox').forEach(cb => cb.checked = false);
                document.getElementById('reviewDate').value = ''; 
                new bootstrap.Modal(document.getElementById('assignReviewerModal')).show();
            },

            confirmAssignment: function() {
                const checkedBoxes = document.querySelectorAll('.reviewer-checkbox:checked');
                const date = document.getElementById('reviewDate').value;
                
                if (checkedBoxes.length === 0) { alert("Chyba: Musíte vybrat alespoň jednoho recenzenta."); return; }
                if (checkedBoxes.length > 2) { alert("Chyba: K článku lze přiřadit maximálně 2 recenzenty."); return; }
                if (!date) { alert("Chyba: Musíte zvolit termín odevzdání recenze."); return; }

                let names = [];
                checkedBoxes.forEach(cb => names.push(cb.value));
                let namesString = names.join(", ");

                bootstrap.Modal.getInstance(document.getElementById('assignReviewerModal')).hide();

                const id = this.currentArticleId;
                // Pozor: Při řazení se DOM mění, musíme hledat v poli allRows i v DOMu
                const row = this.allRows.find(r => r.id === 'row-' + id);
                if (row) {
                    const statusCell = row.getElementsByTagName('td')[5];
                    statusCell.innerHTML = `<span class="badge bg-primary" title="Termín: ${date}">V recenzi (${namesString})</span>`;
                    row.setAttribute('data-status', 'review');
                    alert(`ÚSPĚCH: Pozvánky k recenzi odeslány.\n\nRecenzenti: ${namesString}\nTermín: ${date}`);
                    this.filterAndPaginate(); // Refresh kvůli řazení a filtrům
                }
            },

            deleteArticle: function(id) {
                if(confirm("Opravdu chcete tento článek (ID " + id + ") stáhnout z oběhu?")) {
                    const rowToRemove = this.allRows.find(r => r.id.includes('row-' + id));
                    if (rowToRemove) {
                        rowToRemove.remove();
                        this.allRows = this.allRows.filter(r => r !== rowToRemove);
                        this.filterAndPaginate();
                    }
                }
            },

            showDetail: function(id) {
                // Simulace přesměrování - v reálu by to bylo "detail.php?id=" + id
                window.location.href = "detail.html";
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>